<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>⚡POWER METER⚡</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    

    body {
      font-family: 'Rajdhani', sans-serif;
      background: linear-gradient(45deg, #0a0a0a, #001133, #002244, #003366, #004488, #0055aa);
      background-size: 600% 600%;
      animation: quantumFlow 12s ease infinite;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    @keyframes quantumFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Cyber Grid Background */
    .cyber-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(0, 170, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 170, 255, 0.1) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridPulse 4s ease-in-out infinite;
      z-index: 0;
    }

    @keyframes gridPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    /* Floating Particles */
    .quantum-particles {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: linear-gradient(45deg, #00aaff, #0088ff, #0066ff);
      border-radius: 50%;
      animation: quantumFloat 8s linear infinite;
      box-shadow: 0 0 20px rgba(0, 170, 255, 0.8);
    }

    @keyframes quantumFloat {
      0% { 
        transform: translate(0, 0) scale(0.8);
        opacity: 0;
      }
      20% { 
        transform: translate(50px, -30px) scale(1.2);
        opacity: 1;
      }
      50% { 
        transform: translate(-30px, 40px) scale(1);
        opacity: 0.8;
      }
      80% { 
        transform: translate(40px, -20px) scale(1.1);
        opacity: 0.6;
      }
      100% { 
        transform: translate(0, 0) scale(0.8);
        opacity: 0;
      }
    }

    /* Main Container */
    .container {
      position: relative;
      z-index: 2;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 60px;
      padding: 40px 0;
    }

    .main-title {
      font-family: 'Orbitron', monospace;
      font-size: 4rem;
      font-weight: 900;
      color: #00aaff;
      text-shadow: 
        0 0 20px rgba(0, 170, 255, 0.8),
        0 0 40px rgba(0, 170, 255, 0.6),
        0 0 60px rgba(0, 170, 255, 0.4);
      margin-bottom: 20px;
      animation: hologramGlow 3s ease-in-out infinite;
      letter-spacing: 3px;
    }

    @keyframes hologramGlow {
      0%, 100% { 
        text-shadow: 
          0 0 20px rgba(0, 170, 255, 0.8),
          0 0 40px rgba(0, 170, 255, 0.6),
          0 0 60px rgba(0, 170, 255, 0.4);
      }
      50% { 
        text-shadow: 
          0 0 30px rgba(0, 170, 255, 1),
          0 0 60px rgba(0, 170, 255, 0.8),
          0 0 90px rgba(0, 170, 255, 0.6);
      }
    }

    .subtitle {
      font-size: 1.8rem;
      color: #66ccff;
      font-weight: 500;
      margin-bottom: 30px;
      opacity: 0.9;
      text-shadow: 0 0 15px rgba(102, 204, 255, 0.5);
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      background: rgba(0, 170, 255, 0.1);
      border: 2px solid rgba(0, 170, 255, 0.3);
      border-radius: 50px;
      padding: 12px 25px;
      font-size: 1.2rem;
      color: #00aaff;
      backdrop-filter: blur(10px);
      animation: statusPulse 2s ease-in-out infinite;
    }

    @keyframes statusPulse {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(0, 170, 255, 0.3);
        border-color: rgba(0, 170, 255, 0.3);
      }
      50% { 
        box-shadow: 0 0 40px rgba(0, 170, 255, 0.6);
        border-color: rgba(0, 170, 255, 0.6);
      }
    }

    .status-dot {
      width: 12px;
      height: 12px;
      background: #00ff88;
      border-radius: 50%;
      margin-right: 10px;
      animation: dotBlink 1.5s ease-in-out infinite;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
    }

    @keyframes dotBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
        /* Matrix Rain Effect */
        .matrix-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .matrix-column {
            position: absolute;
            top: -100%;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: var(--neon-green);
            opacity: 0.8;
            animation: matrixFall linear infinite;
        }

        @keyframes matrixFall {
            to { transform: translateY(100vh); }
        }

    /* Navigation */
    .nav-breadcrumb {
      margin-bottom: 40px;
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 1.2rem;
      color: #66ccff;
    }

    .nav-link {
      color: #00aaff;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 20px;
      background: rgba(0, 170, 255, 0.1);
      border: 1px solid rgba(0, 170, 255, 0.3);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .nav-link:hover {
      background: rgba(0, 170, 255, 0.2);
      border-color: rgba(0, 170, 255, 0.5);
      transform: translateY(-2px);
    }

    .nav-separator {
      color: #66ccff;
      opacity: 0.6;
    }

    /* Main Grid */
    .main-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 40px;
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
    }

    /* Card Styles */
    .year-card, .month-card {
      background: rgba(0, 170, 255, 0.05);
      border: 2px solid rgba(0, 170, 255, 0.2);
      border-radius: 25px;
      padding: 40px 30px;
      text-align: center;
      backdrop-filter: blur(20px);
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      transform: perspective(1000px) rotateX(0deg);
      cursor: pointer;
    }

    .year-card.unavailable, .month-card.unavailable {
      background: rgba(100, 100, 100, 0.05);
      border: 2px solid rgba(100, 100, 100, 0.2);
      opacity: 0.6;
      cursor: default;
    }

    .year-card::before, .month-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(0, 170, 255, 0.1), transparent);
      transform: rotate(45deg);
      transition: all 0.6s ease;
      opacity: 0;
    }

    .year-card:not(.unavailable):hover::before, 
    .month-card:not(.unavailable):hover::before {
      animation: scanLine 2s linear infinite;
      opacity: 1;
    }

    @keyframes scanLine {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .year-card:not(.unavailable):hover, 
    .month-card:not(.unavailable):hover {
      transform: perspective(1000px) rotateX(5deg) translateY(-15px);
      border-color: rgba(0, 170, 255, 0.6);
      box-shadow: 
        0 25px 50px rgba(0, 170, 255, 0.2),
        0 0 50px rgba(0, 170, 255, 0.1);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 25px;
    }

    .card-icon {
      font-size: 3.5rem;
      margin-right: 15px;
      animation: iconFloat 3s ease-in-out infinite;
    }

    .unavailable .card-icon {
      animation: none;
      opacity: 0.5;
    }

    @keyframes iconFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .card-title {
      font-family: 'Orbitron', monospace;
      font-size: 2rem;
      font-weight: 700;
      color: #00aaff;
      text-shadow: 0 0 15px rgba(0, 170, 255, 0.5);
    }

    .unavailable .card-title {
      color: #888;
      text-shadow: none;
    }

    .card-description {
      font-size: 1.3rem;
      color: #66ccff;
      margin-bottom: 20px;
      line-height: 1.6;
      opacity: 0.9;
    }

    .unavailable .card-description {
      color: #888;
      opacity: 0.7;
    }

    .card-stats {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      padding: 15px 0;
      border-top: 1px solid rgba(0, 170, 255, 0.2);
      border-bottom: 1px solid rgba(0, 170, 255, 0.2);
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: #00aaff;
      display: block;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #66ccff;
      opacity: 0.8;
    }

    /* Download Button */
    .download-button {
      background: linear-gradient(135deg, #0044aa, #0066cc, #0088ff, #00aaff);
      background-size: 300% 300%;
      animation: buttonFlow 4s ease infinite;
      color: white;
      border: none;
      padding: 18px 40px;
      font-size: 1.4rem;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 
        0 15px 30px rgba(0, 170, 255, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
      font-family: 'Rajdhani', sans-serif;
      position: relative;
      overflow: hidden;
      min-width: 200px;
      border: 2px solid rgba(0, 170, 255, 0.3);
      margin-top: 10px;
    }

    .download-button.unavailable {
      background: linear-gradient(135deg, #444, #666, #888);
      animation: none;
      cursor: not-allowed;
      box-shadow: 
        0 15px 30px rgba(100, 100, 100, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(100, 100, 100, 0.3);
    }

    @keyframes buttonFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .download-button:not(.unavailable):hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 
        0 25px 50px rgba(0, 170, 255, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      border-color: rgba(0, 170, 255, 0.6);
    }

    .file-size {
      font-size: 1.1rem;
      color: #88ddff;
      margin-top: 10px;
      opacity: 0.8;
    }

    .coming-soon {
      font-size: 1.1rem;
      color: #ff8888;
      margin-top: 15px;
      opacity: 0.8;
      font-weight: 600;
    }

    /* Progress Bar */
    .progress-container {
      width: 100%;
      height: 4px;
      background: rgba(0, 170, 255, 0.2);
      border-radius: 2px;
      margin-top: 20px;
      overflow: hidden;
      display: none;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #00aaff, #0088ff);
      border-radius: 2px;
      transition: width 0.3s ease;
      width: 0%;
    }

    /* Hidden/Show Views */
    .view {
      display: none;
      width: 100%;
    }

    .view.active {
      display: block;
    }

    /* Footer */
    .footer {
      margin-top: 80px;
      text-align: center;
      padding: 30px 0;
      border-top: 1px solid rgba(0, 170, 255, 0.2);
      width: 100%;
    }

    .footer-text {
      color: #66ccff;
      font-size: 1.2rem;
      opacity: 0.8;
    }

    /* Mobile Notice */
    .mobile-notice {
      display: none;
      background: rgba(255, 136, 0, 0.1);
      border: 2px solid rgba(255, 136, 0, 0.3);
      border-radius: 15px;
      padding: 15px;
      margin: 10px 0;
      color: #ffaa44;
      font-size: 0.9rem;
      text-align: center;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .main-title {
        font-size: 2.5rem;
        letter-spacing: 2px;
      }
      
      .subtitle {
        font-size: 1.4rem;
      }
      
      .main-grid {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      
      .year-card, .month-card {
        padding: 30px 20px;
      }
      
      .card-title {
        font-size: 1.6rem;
      }
      
      .card-description {
        font-size: 1.1rem;
      }
      
      .download-button {
        padding: 16px 30px;
        font-size: 1.2rem;
        min-width: 180px;
      }

      .mobile-notice {
        display: block;
      }
    }

    @media (max-width: 480px) {
      .main-title {
        font-size: 2rem;
        letter-spacing: 1px;
      }
      
      .subtitle {
        font-size: 1.2rem;
      }
      
      .status-indicator {
        font-size: 1rem;
        padding: 10px 20px;
      }
      
      .year-card, .month-card {
        padding: 25px 15px;
        margin: 0 10px;
      }
      
      .card-icon {
        font-size: 2.5rem;
      }
      
      .card-title {
        font-size: 1.4rem;
      }
      
      .download-button {
        padding: 14px 25px;
        font-size: 1.1rem;
        min-width: 160px;
      }
    }
  </style>
</head>
<body>
  <div class="cyber-grid"></div>
  
  <div class="quantum-particles" id="particleContainer">
    <!-- Particles will be generated dynamically -->
  </div>

  <div class="container">
    <div class="header">
      <h1 class="main-title">⚡POWER METER</h1>
      <p class="subtitle">ดาวน์โหลดข้อมูล POWER METER</p>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span>DATA ONLINE</span>
      </div>
    </div>

    <!-- Navigation Breadcrumb -->
    <div class="nav-breadcrumb" id="breadcrumb">
      <span class="nav-link" onclick="showYearView()">🏠 หน้าหลัก</span>
    </div>

    <!-- Year View -->
    <div class="view active" id="yearView">
      <div class="main-grid" id="yearGrid">
        <!-- Year cards will be generated here -->
      </div>
    </div>

    <!-- Month View -->
    <div class="view" id="monthView">
      <div class="main-grid" id="monthGrid">
        <!-- Month cards will be generated here -->
      </div>
    </div>

    <div class="footer">
      <p class="footer-text">
        🔒 ข้อมูลเข้ารหัสและปลอดภัย | อัปเดตแบบ Real-time ทุกวัน
      </p>
    </div>
  </div>

  <script>
    // Mobile detection
    function isMobile() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    // Data structure organized by year
    const yearData = {
      '2025': {
        icon: '📅',
        title: '2025',
        description: 'ข้อมูล Power Meter ปี 2025<br>รวมทุกเดือนในปี',
        available: true,
        months: {
          'กรกฎาคม': {
            icon: '📊',
            description: 'ข้อมูล PD7 เดือนกรกฎาคม<br>พร้อมให้ดาวน์โหลด',
            fileSize: '~2.5 MB',
            url: 'https://docs.google.com/spreadsheets/d/1X_ZpdlyNzTjpZPnFTwPFGQHUTGpGXMjJ/edit?usp=sharing&ouid=103243829117381280273&rtpof=true&sd=true',
            exportUrl: 'https://docs.google.com/spreadsheets/d/1X_ZpdlyNzTjpZPnFTwPFGQHUTGpGXMjJ/export?format=xlsx',
            available: true
          },
          'สิงหาคม': {
            icon: '📈',
            description: 'ข้อมูล PD7 เดือนสิงหาคม<br>พร้อมให้ดาวน์โหลด',
            fileSize: '~2.8 MB',
            url: 'https://docs.google.com/spreadsheets/d/1hjCWANmybYZ2wK8iVuhkjtzkadxG2bS1/edit?usp=sharing&ouid=103243829117381280273&rtpof=true&sd=true',
            exportUrl: 'https://docs.google.com/spreadsheets/d/1hjCWANmybYZ2wK8iVuhkjtzkadxG2bS1/export?format=xlsx',
            available: true
          },
          'กันยาคม': {
            icon: '📋',
            description: 'ข้อมูล PD7 เดือนกันยาคม<br>กำลังเตรียมข้อมูล',
            fileSize: '~3.0 MB',
            url: '',
            exportUrl: '',
            available: false
          },
          'ตุลาคม': {
            icon: '🔄',
            description: 'ข้อมูล PD7 เดือนตุลาคม<br>กำลังเตรียมข้อมูล',
            fileSize: '~2.7 MB',
            url: '',
            exportUrl: '',
            available: false
          },
          'พฤศจิกายน': {
            icon: '⚡',
            description: 'ข้อมูล PD7 เดือนพฤศจิกายน<br>กำลังเตรียมข้อมูล',
            fileSize: '~2.9 MB',
            url: '',
            exportUrl: '',
            available: false
          },
          'ธันวาคม': {
            icon: '🎯',
            description: 'ข้อมูล PD7 เดือนธันวาคม<br>กำลังเตรียมข้อมูล',
            fileSize: '~3.2 MB',
            url: '',
            exportUrl: '',
            available: false
          }
        }
      },
      '2026': {
        icon: '📅',
        title: '2026',
        description: 'ข้อมูล Power Meter ปี 2026<br>กำลังเตรียมข้อมูล',
        available: false,
        months: {
          'มกราคม': { icon: '📊', description: 'ข้อมูล PD7 เดือนมกราคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'กุมภาพันธ์': { icon: '📈', description: 'ข้อมูล PD7 เดือนกุมภาพันธ์<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'มีนาคม': { icon: '📋', description: 'ข้อมูล PD7 เดือนมีนาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'เมษายน': { icon: '🔄', description: 'ข้อมูล PD7 เดือนเมษายน<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'พฤษภาคม': { icon: '⚡', description: 'ข้อมูล PD7 เดือนพฤษภาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'มิถุนายน': { icon: '🎯', description: 'ข้อมูล PD7 เดือนมิถุนายน<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'กรกฎาคม': { icon: '📊', description: 'ข้อมูล PD7 เดือนกรกฎาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'สิงหาคม': { icon: '📈', description: 'ข้อมูล PD7 เดือนสิงหาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'กันยาคม': { icon: '📋', description: 'ข้อมูล PD7 เดือนกันยาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'ตุลาคม': { icon: '🔄', description: 'ข้อมูล PD7 เดือนตุลาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'พฤศจิกายน': { icon: '⚡', description: 'ข้อมูล PD7 เดือนพฤศจิกายน<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'ธันวาคม': { icon: '🎯', description: 'ข้อมูล PD7 เดือนธันวาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false }
        }
      },
      '2027': {
        icon: '📅',
        title: '2027',
        description: 'ข้อมูล Power Meter ปี 2027<br>กำลังเตรียมข้อมูล',
        available: false,
        months: {
          'มกราคม': { icon: '📊', description: 'ข้อมูล PD7 เดือนมกราคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'กุมภาพันธ์': { icon: '📈', description: 'ข้อมูล PD7 เดือนกุมภาพันธ์<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'มีนาคม': { icon: '📋', description: 'ข้อมูล PD7 เดือนมีนาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'เมษายน': { icon: '🔄', description: 'ข้อมูล PD7 เดือนเมษายน<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'พฤษภาคม': { icon: '⚡', description: 'ข้อมูล PD7 เดือนพฤษภาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'มิถุนายน': { icon: '🎯', description: 'ข้อมูล PD7 เดือนมิถุนายน<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'กรกฎาคม': { icon: '📊', description: 'ข้อมูล PD7 เดือนกรกฎาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'สิงหาคม': { icon: '📈', description: 'ข้อมูล PD7 เดือนสิงหาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'กันยาคม': { icon: '📋', description: 'ข้อมูล PD7 เดือนกันยาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'ตุลาคม': { icon: '🔄', description: 'ข้อมูล PD7 เดือนตุลาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'พฤศจิกายน': { icon: '⚡', description: 'ข้อมูล PD7 เดือนพฤศจิกายน<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false },
          'ธันวาคม': { icon: '🎯', description: 'ข้อมูล PD7 เดือนธันวาคม<br>กำลังเตรียมข้อมูล', fileSize: '~2.5 MB', url: '', exportUrl: '', available: false }
        }
      }
      
    };

    // Current view state
    let currentView = 'year';
    let currentYear = null;

    // Generate year cards
    function generateYearCards() {
      const grid = document.getElementById('yearGrid');
      grid.innerHTML = '';

      Object.entries(yearData).forEach(([year, data]) => {
        const availableMonths = Object.values(data.months).filter(month => month.available).length;
        const totalMonths = Object.keys(data.months).length;
        
        const card = document.createElement('div');
        card.className = `year-card ${!data.available ? 'unavailable' : ''}`;
        card.onclick = () => showMonthView(year);
        
        card.innerHTML = `
          <div class="card-header">
            <div class="card-icon">${data.icon}</div>
            <h2 class="card-title">${data.title}</h2>
          </div>
          <p class="card-description">${data.description}</p>
          <div class="card-stats">
            <div class="stat-item">
              <span class="stat-number">${availableMonths}</span>
              <span class="stat-label">พร้อม</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${totalMonths - availableMonths}</span>
              <span class="stat-label">รอ</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${totalMonths}</span>
              <span class="stat-label">รวม</span>
            </div>
          </div>
          ${data.available ? 
            '<div class="file-size">📁 คลิกเพื่อดูรายเดือน</div>' : 
            '<div class="coming-soon">เร็วๆ นี้</div>'
          }
        `;
        
        grid.appendChild(card);
      });
    }

    // Generate month cards for specific year
    function generateMonthCards(year) {
      const grid = document.getElementById('monthGrid');
      grid.innerHTML = '';

      const yearInfo = yearData[year];
      if (!yearInfo) return;

      Object.entries(yearInfo.months).forEach(([month, data]) => {
        const card = document.createElement('div');
        card.className = `month-card ${!data.available ? 'unavailable' : ''}`;
        
        const mobileNotice = data.available && isMobile() ? 
          '<div class="mobile-notice">📱 มือถือ: กดเพื่อเปิดใน Google Sheets</div>' : '';
        
        card.innerHTML = `
          <div class="card-header">
            <div class="card-icon">${data.icon}</div>
            <h2 class="card-title">${month} ${year}</h2>
          </div>
          <p class="card-description">${data.description}</p>
          ${mobileNotice}
          <button class="download-button ${!data.available ? 'unavailable' : ''}" 
                  ${!data.available ? 'disabled' : ''} 
                  onclick="downloadFile('${year}', '${month}')">
            <span>${data.available ? '📥 ดาวน์โหลดไฟล์' : '⏳ ยังไม่พร้อม'}</span>
          </button>
          ${data.available ? 
            `<div class="file-size">ขนาดไฟล์: ${data.fileSize}</div>` : 
            '<div class="coming-soon">เร็วๆ นี้</div>'
          }
          <div class="progress-container" id="progress-${year}-${month}">
            <div class="progress-bar"></div>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }

    // Show year view
    function showYearView() {
      currentView = 'year';
      currentYear = null;
      
      document.getElementById('yearView').classList.add('active');
      document.getElementById('monthView').classList.remove('active');
      
      // Update breadcrumb
      document.getElementById('breadcrumb').innerHTML = `
        <span class="nav-link" onclick="showYearView()">🏠 หน้าหลัก</span>
      `;
      
      generateYearCards();
    }

    // Show month view for specific year
    function showMonthView(year) {
      if (!yearData[year] || !yearData[year].available) {
        console.log(`Year ${year} is not available`);
        return;
      }
      
      currentView = 'month';
      currentYear = year;
      
      document.getElementById('yearView').classList.remove('active');
      document.getElementById('monthView').classList.add('active');
      
      // Update breadcrumb
      document.getElementById('breadcrumb').innerHTML = `
        <span class="nav-link" onclick="showYearView()">🏠 หน้าหลัก</span>
        <span class="nav-separator">›</span>
        <span class="nav-link">${year}</span>
      `;
      
      generateMonthCards(year);
    }

    // Download function
    function downloadFile(year, month) {
      const data = yearData[year]?.months[month];
      
      if (!data || !data.available || !data.url) {
        console.log(`${month} ${year} is not available for download`);
        return;
      }
      
      const progressContainer = document.getElementById(`progress-${year}-${month}`);
      const progressBar = progressContainer.querySelector('.progress-bar');
      const mobile = isMobile();
      
      // Show progress bar
      progressContainer.style.display = 'block';
      
      // Button animation
      event.target.style.transform = 'translateY(-2px) scale(0.95)';
      setTimeout(() => {
        event.target.style.transform = '';
      }, 200);
      
      // Simulate download progress
      let progress = 0;
      const progressInterval = setInterval(() => {
        progress += Math.random() * 20;
        if (progress > 100) progress = 100;
        
        progressBar.style.width = progress + '%';
        
        if (progress >= 100) {
          clearInterval(progressInterval);
          
          // Choose URL based on device type
          let targetUrl;
          if (mobile && data.exportUrl) {
            targetUrl = data.exportUrl;
          } else {
            targetUrl = data.url;
          }
          
          // Create and trigger download/open
          const link = document.createElement('a');
          link.href = targetUrl;
          
          if (mobile) {
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
          } else {
            link.download = `PowerMeter_PD7_${month}_${year}_${new Date().toISOString().split('T')[0]}.xlsx`;
            link.target = '_blank';
          }
          
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          // For mobile: also try alternative method
          if (mobile) {
            setTimeout(() => {
              window.open(targetUrl, '_blank', 'noopener,noreferrer');
            }, 500);
          }
          
          // Hide progress bar after download
          setTimeout(() => {
            progressContainer.style.display = 'none';
            progressBar.style.width = '0%';
          }, 1500);
        }
      }, 80);
    }

    // Management functions
    window.powerMeterManager = {
      // Enable a month (make it available for download)
      enableMonth: function(year, month, url, exportUrl = '', fileSize = '~2.5 MB') {
        if (!yearData[year] || !yearData[year].months[month]) {
          console.error(`Month ${month} in year ${year} not found`);
          return;
        }
        
        // Auto-generate export URL if not provided
        if (!exportUrl && url.includes('docs.google.com/spreadsheets/d/')) {
          const docId = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
          const gidMatch = url.match(/gid=([0-9]+)/);
          if (docId) {
            exportUrl = `https://docs.google.com/spreadsheets/d/${docId[1]}/export?format=xlsx`;
            if (gidMatch) {
              exportUrl += `&gid=${gidMatch[1]}`;
            }
          }
        }
        
        yearData[year].months[month] = {
          ...yearData[year].months[month],
          url: url,
          exportUrl: exportUrl,
          fileSize: fileSize,
          available: true,
          description: `ข้อมูล PD7 เดือน${month}<br>พร้อมให้ดาวน์โหลด`
        };
        
        // Enable year if it has at least one available month
        const hasAvailableMonth = Object.values(yearData[year].months).some(m => m.available);
        if (hasAvailableMonth) {
          yearData[year].available = true;
        }
        
        // Refresh current view
        if (currentView === 'year') {
          generateYearCards();
        } else if (currentView === 'month' && currentYear === year) {
          generateMonthCards(year);
        }
        
        console.log(`Enabled ${month} ${year} for download`);
      },
      
      // Disable a month
      disableMonth: function(year, month) {
        if (!yearData[year] || !yearData[year].months[month]) {
          console.error(`Month ${month} in year ${year} not found`);
          return;
        }
        
        yearData[year].months[month] = {
          ...yearData[year].months[month],
          url: '',
          exportUrl: '',
          available: false,
          description: `ข้อมูล PD7 เดือน${month}<br>กำลังเตรียมข้อมูล`
        };
        
        // Check if year should be disabled
        const hasAvailableMonth = Object.values(yearData[year].months).some(m => m.available);
        if (!hasAvailableMonth) {
          yearData[year].available = false;
        }
        
        // Refresh current view
        if (currentView === 'year') {
          generateYearCards();
        } else if (currentView === 'month' && currentYear === year) {
          generateMonthCards(year);
        }
        
        console.log(`Disabled ${month} ${year}`);
      },
      
      // Enable a full year
      enableYear: function(year) {
        if (!yearData[year]) {
          console.error(`Year ${year} not found`);
          return;
        }
        
        yearData[year].available = true;
        yearData[year].description = `ข้อมูล Power Meter ปี ${year}<br>รวมทุกเดือนในปี`;
        
        // Refresh year view if active
        if (currentView === 'year') {
          generateYearCards();
        }
        
        console.log(`Enabled year ${year}`);
      },
      
      // Get current data
      getData: function() {
        return yearData;
      },
      
      // Get available months for a year
      getAvailableMonths: function(year) {
        if (!yearData[year]) return [];
        return Object.entries(yearData[year].months)
          .filter(([month, data]) => data.available)
          .map(([month, data]) => month);
      },
      
      // Quick enable next month function
      enableNextMonth: function(url, exportUrl = '', fileSize = '~2.5 MB') {
        // Find the first unavailable month in the earliest available year
        for (const [year, yearInfo] of Object.entries(yearData)) {
          const months = Object.entries(yearInfo.months);
          const nextMonth = months.find(([month, data]) => !data.available);
          if (nextMonth) {
            this.enableMonth(year, nextMonth[0], url, exportUrl, fileSize);
            console.log(`Enabled ${nextMonth[0]} ${year} for download`);
            return;
          }
        }
        console.log('All months are already enabled');
      },
      
      // Check if running on mobile
      isMobile: isMobile,
      
      // Navigation helpers
      showYear: showYearView,
      showMonth: showMonthView
    };

    // Dynamic particle creation
    function createParticle() {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.top = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 8 + 's';
      document.getElementById('particleContainer').appendChild(particle);
      
      // Remove particle after animation
      setTimeout(() => {
        particle.remove();
      }, 8000);
    }

    // Initialize particle system
    function initParticles() {
      // Create initial particles
      for (let i = 0; i < 6; i++) {
        createParticle();
      }
      
      // Create new particles periodically
      setInterval(createParticle, 2000);
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      showYearView();
      initParticles();
      
      // Log helper message
      console.log('Power Meter Manager loaded!');
      console.log('Available functions:', Object.keys(window.powerMeterManager));
      console.log('Example: powerMeterManager.enableMonth("2025", "กันยาคม", "YOUR_URL")');
    });
  </script>




